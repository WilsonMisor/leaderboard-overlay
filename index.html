<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Leaderboard</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: Arial, sans-serif;
      color: #fff;
      background: rgba(0, 0, 0, 0.6);
    }
    h3 {
      margin-bottom: 8px;
      font-size: 18px;
      text-align: center;
    }
    #lbTable {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    #lbTable th, #lbTable td {
      padding: 6px 12px;
      border: 1px solid rgba(255,255,255,0.2);
      text-align: left;
    }
    #lbTable th {
      background: #222;
      font-size: 14px;
    }
    #lbTable tr:nth-child(even) {
      background: rgba(255,255,255,0.1);
    }
    #chartContainer {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <h3>Live Leaderboard</h3>

  <!-- Leaderboard Table -->
  <table id="lbTable">
    <tr><th>Contestant</th><th>Votes</th></tr>
  </table>

  <!-- Bar Chart Below -->
  <div id="chartContainer">
    <canvas id="barChart"></canvas>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ▶️ Replace with your published-to-web CSV URL
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQFIkiha46dsmYyOFZElLATgp3kgFnuAjXQyFGzh_IV1ZH2s3T211__gfM2RpGC51jTb4sPBCF2CUFJ/pub?gid=1469374722&single=true&output=csv';

    let chartInstance;

    // Fetch and parse CSV
    async function fetchLeaderboardData() {
      const url = CSV_URL + '&cache=' + Date.now();
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Fetch error: ${res.status}`);
      const text = await res.text();
      const rows = text.trim().split(/\r?\n/).slice(1);
      const labels = [], votes = [];
      rows.forEach(line => {
        const [label, vote] = line.split(',');
        if (label && vote) {
          labels.push(label);
          votes.push(+vote);
        }
      });
      return { labels, votes };
    }

    // Render table
    function renderTable(labels, votes) {
      let html = '<tr><th>Contestant</th><th>Votes</th></tr>';
      labels.forEach((lbl, i) => {
        html += `<tr><td>${lbl}</td><td>${votes[i]}</td></tr>`;
      });
      document.getElementById('lbTable').innerHTML = html;
    }

    // Create or update Chart.js bar chart
    async function renderChart() {
      try {
        const { labels, votes } = await fetchLeaderboardData();
        renderTable(labels, votes);

        const ctx = document.getElementById('barChart').getContext('2d');
        if (chartInstance) {
          chartInstance.data.labels = labels;
          chartInstance.data.datasets[0].data = votes;
          chartInstance.update();
        } else {
          chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
              labels,
              datasets: [{
                label: 'Votes',
                data: votes,
                backgroundColor: 'rgba(54, 162, 235, 0.8)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
              }]
            },
            options: {
              indexAxis: 'y',             // horizontal bars
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  beginAtZero: true,
                  ticks: { color: '#fff' },
                  grid: { color: 'rgba(255,255,255,0.1)' }
                },
                y: {
                  ticks: { color: '#fff', font: { size: 14 } },
                  grid: { display: false }
                }
              },
              plugins: {
                legend: {
                  display: true,
                  labels: { color: '#fff', boxWidth: 12 }
                },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.parsed.x} votes`
                  }
                }
              }
            }
          });
        }
      } catch (err) {
        console.error('Leaderboard render error:', err);
      }
    }

    // Initial render + refresh every 5 seconds
    renderChart();
    setInterval(renderChart, 5000);
  </script>
</body>
</html>

